


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>Methods - Curve Fit</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a676eddb.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.b302131d.min.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="green" data-md-color-accent="green">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Curve Fit" class="md-header-nav__button md-logo" aria-label="Curve Fit">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Curve Fit
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Methods
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Curve Fit" class="md-nav__button md-logo" aria-label="Curve Fit">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    Curve Fit
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Methods
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="Methods" class="md-nav__link md-nav__link--active">
      Methods
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#covid-19-functional-forms" class="md-nav__link">
    COVID-19 functional forms
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statistical-model" class="md-nav__link">
    Statistical Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constraints" class="md-nav__link">
    Constraints
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimization-procedure" class="md-nav__link">
    Optimization Procedure
  </a>
  
    <nav class="md-nav" aria-label="Optimization Procedure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#solver" class="md-nav__link">
    Solver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#derivatives" class="md-nav__link">
    Derivatives
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uncertainty" class="md-nav__link">
    Uncertainty
  </a>
  
    <nav class="md-nav" aria-label="Uncertainty">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#predictive-validity-based-uncertainty" class="md-nav__link">
    Predictive Validity-Based Uncertainty
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-based-uncertainty" class="md-nav__link">
    Model-Based Uncertainty
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../code/" title="Code" class="md-nav__link">
      Code
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../updates/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Examples
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Examples" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/get_started_xam/" title="get_started_xam" class="md-nav__link">
      get_started_xam
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/covariate_xam/" title="covariate_xam" class="md-nav__link">
      covariate_xam
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/random_effect_xam/" title="random_effect_xam" class="md-nav__link">
      random_effect_xam
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/param_time_fun_xam/" title="param_time_fun_xam" class="md-nav__link">
      param_time_fun_xam
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Developer Doc
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Developer Doc" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Developer Doc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/unzip_x/" title="unzip_x" class="md-nav__link">
      unzip_x
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/sizes_to_indices/" title="sizes_to_indices" class="md-nav__link">
      sizes_to_indices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/st_loss/" title="st_loss" class="md-nav__link">
      st_loss
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/normal_loss/" title="normal_loss" class="md-nav__link">
      normal_loss
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/split_by_group/" title="split_by_group" class="md-nav__link">
      split_by_group
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/param_time_fun/" title="param_time_fun" class="md-nav__link">
      param_time_fun
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/effects2params/" title="effects2params" class="md-nav__link">
      effects2params
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/objective_fun/" title="objective_fun" class="md-nav__link">
      objective_fun
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/extract_md.py/" title="extract_md.py" class="md-nav__link">
      extract_md.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/get_cppad_py.py/" title="get_cppad_py.py" class="md-nav__link">
      get_cppad_py.py
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-11" type="checkbox" id="nav-6-11">
    
    <label class="md-nav__link" for="nav-6-11">
      Developer Examples
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Developer Examples" data-md-level="2">
      <label class="md-nav__title" for="nav-6-11">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Developer Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/unzip_x_xam/" title="unzip_x_xam" class="md-nav__link">
      unzip_x_xam
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/sizes_to_indices_xam/" title="sizes_to_indices_xam" class="md-nav__link">
      sizes_to_indices_xam
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/loss_xam/" title="loss_xam" class="md-nav__link">
      loss_xam
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/effects2params_xam/" title="effects2params_xam" class="md-nav__link">
      effects2params_xam
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../extract_md/objective_fun_xam/" title="objective_fun_xam" class="md-nav__link">
      objective_fun_xam
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#covid-19-functional-forms" class="md-nav__link">
    COVID-19 functional forms
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statistical-model" class="md-nav__link">
    Statistical Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constraints" class="md-nav__link">
    Constraints
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimization-procedure" class="md-nav__link">
    Optimization Procedure
  </a>
  
    <nav class="md-nav" aria-label="Optimization Procedure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#solver" class="md-nav__link">
    Solver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#derivatives" class="md-nav__link">
    Derivatives
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uncertainty" class="md-nav__link">
    Uncertainty
  </a>
  
    <nav class="md-nav" aria-label="Uncertainty">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#predictive-validity-based-uncertainty" class="md-nav__link">
    Predictive Validity-Based Uncertainty
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-based-uncertainty" class="md-nav__link">
    Model-Based Uncertainty
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="overview">Overview</h1>
<p>CurveFit is an extendable nonlinear mixed effects model for fitting curves.
The main application in this development is COVID-19 forecasting, so that
the curves we consider are variants of logistic models. However the interface
allows any user-specified parametrized family.</p>
<p>Parametrized curves have several key features that make them useful for forecasting:</p>
<ul>
<li>We can capture key signals from noisy data.</li>
<li>Parameters are interpretable, and can be modeled using covariates in a transparent way.</li>
<li>Parametric forms allow for more stable inversion approaches, for current and future work.</li>
<li>Parametric functions impose rigid assumptions that make forecasting more stable.</li>
</ul>
<h2 id="covid-19-functional-forms">COVID-19 functional forms</h2>
<p>We considered two functional forms so far when modeling the COVID-19 epidemic.</p>
<ul>
<li>
<p><strong>Generalized Logistic:</strong> <script type="math/tex; mode=display">f(t; \alpha, \beta, p)  = \frac{p}{1 + \exp(-\alpha(t-\beta))}</script>
</p>
</li>
<li>
<p><strong>Generalized Gaussian Cumulative Distribution Function</strong> <script type="math/tex; mode=display">
 f(t;  \alpha, \beta, p) = \frac{p}{2}\left(\Psi(\alpha(t-\beta)\right) = \frac{p}{2}\left(1+ \frac{2}{\sqrt{\pi}}\int_{0}^{\alpha(t-\beta)} \exp\left(-\tau^2\right)d\tau\right)
</script>
</p>
</li>
</ul>
<p>Each form has comparable fundamental parameters:</p>
<ul>
<li><strong>Level <script type="math/tex">p</script>:</strong>  Controls the ultimate level.</li>
<li><strong>Slope <script type="math/tex">\alpha</script></strong>:  Controls speed of infection.</li>
<li><strong>Inflection <script type="math/tex">\beta</script></strong>: Time at which the  rate of change is maximal.</li>
</ul>
<p>We can fit these parameters to data, but this by itself does not account for covariates, and cannot
connect different locations together. The next section therefore specifies statistical models that do this.</p>
<h2 id="statistical-model">Statistical Model</h2>
<p>Statistical assumptions link covariates across locations. Key aspects are the following:</p>
<ul>
<li>
<p>Parameters may be influenced by covariates, e.g. those that reflect social distancing</p>
</li>
<li>
<p>Parameters may be modeled in a different space, e.g. <script type="math/tex">p, \alpha</script> are non-negative</p>
</li>
<li>
<p>Parameters and covariate multipliers may be location-specific, with assumptions
placed on their variation.</p>
</li>
</ul>
<p>CurveFit specification is tailored to these three requirements. Every parameter in any functional form
can be specified through a link function, covariates, fixed, and random effects. The final estimation
problem is a nonlinear mixed effects model, with user-specified priors on fixed and random effects.</p>
<p>For example, consider the ERF functional form with covariates <script type="math/tex">\alpha, \beta, p</script>.
Assume we are fitting data in log-cumulative-death-rate space. Input data are:</p>
<ul>
<li>
<script type="math/tex">S_j</script>: social distancing covariate value at location <script type="math/tex">j</script>
</li>
<li>
<script type="math/tex">y_j^t</script>: cumulative death rate in location <script type="math/tex">j</script> at time <script type="math/tex">t</script>
</li>
</ul>
<p>We specify the statistical model as follows:</p>
<ul>
<li>
<p>Measurement model:
<script type="math/tex; mode=display">
\begin{aligned}
\log(y_j^t) &= \frac{p_j}{2}\left(1+ \frac{2}{\sqrt{\pi}}\int_{0}^{\alpha_j(t-\beta_j)} \exp\left(-\tau^2\right)d\tau\right) + \epsilon_{t,j} \\
\epsilon_{t,j} & \sim N(0, V_t)
\end{aligned}
</script>
</p>
</li>
<li>
<p>
<script type="math/tex">\beta</script>-model specification:
<script type="math/tex; mode=display">
\begin{aligned}
\beta_j &= \beta + \gamma_j S_j + \epsilon_j^\beta \\
\gamma_j &\sim N(\overline \gamma, V_\gamma) \\
\epsilon_j^\beta &\sim N(0, V_\beta)
\end{aligned}
</script>
</p>
</li>
<li>
<script type="math/tex">\alpha</script>-model specification:
<script type="math/tex; mode=display">
\begin{aligned}
\alpha_j &= \exp(\alpha + u_j^\alpha) \\
u_{\alpha, j} & \sim N(0, V_\alpha)
\end{aligned}
</script>
</li>
<li>
<script type="math/tex">p</script>-model specification:
<script type="math/tex; mode=display">
\begin{aligned}
p_j & = \exp(p + u_j^p) \\
u_{p,j} & \sim N(0, V_p)
\end{aligned}
</script>
</li>
</ul>
<p>In this example, the user specifies</p>
<ul>
<li>prior mean <script type="math/tex">\overline \gamma</script>
</li>
<li>variance parameters <script type="math/tex">V_t, V_\gamma, V_\beta, V_\alpha, V_p</script>.</li>
</ul>
<p>CurveFit estimates:</p>
<ul>
<li>fixed effects <script type="math/tex">\alpha, \beta, p</script>
</li>
<li>random effects <script type="math/tex">\{\gamma_j, u_j^\alpha, u_j^\beta, u_j^p\}</script>
</li>
</ul>
<p>Exponential link functions are used to model non-negative parameters <script type="math/tex">\alpha, p</script>.</p>
<h2 id="constraints">Constraints</h2>
<p>Simple bound constraints on parameters can be used to make the model more robust.
For any fixed or random effect, the user can enter simple bound constraints of the form
<script type="math/tex; mode=display">
L \leq \theta \leq U.
</script>
The parameters returned by CurveFit are guaranteed to satisfy these simple bounds.</p>
<h2 id="optimization-procedure">Optimization Procedure</h2>
<p>The optimization problem we obtain from specifying functional forms, priors, and constraints on all parameters
is a bound-constrained nonlinear least squares problem. We explain the solver, derivative computation, and initialization
procedure below.</p>
<h3 id="solver">Solver</h3>
<p>We solve the problem using <a href="https://docs.scipy.org/doc/scipy/reference/optimize.minimize-lbfgsb.html">L-BFGS-B</a>.
The L-BFGS-B algorithm uses gradients to build a Hessian approximation, and efficiently uses that approximation
and projected gradient method onto the bound constraints to identify parameter spaces over which solutions can be efficiently found,
see the <a href="http://www.ece.northwestern.edu/~nocedal/PSfiles/limited.ps.gz">paper</a>. It is a standard and robust algorithm that's well
suited to the task.</p>
<h3 id="derivatives">Derivatives</h3>
<p>We do not explicitly compute derivatives of the nonlinear least squares objective induced from the problem specification.
Instead, we use the <a href="https://dl.acm.org/doi/abs/10.1145/838250.838251?casa_token=TYWyEC47VgkAAAAA:Qo1BmjP8jlvs5SOBqH2jw1VPMX4IV6SnjKfltmCgJP8jRM1nUThentKVdr2R0c3rBSfWry-_dZY">complex step method</a> to do this.
The complex step method is a simple example of <a href="https://en.wikipedia.org/wiki/Automatic_differentiation">Automatic Differentiation</a>,
that is, it can provide machine precision derivatives at the cost of a function evaluation.
This is very useful given the flexibility on functional forms.</p>
<h2 id="uncertainty">Uncertainty</h2>
<p>Currently CurveFit uses model-based uncertainty, with out-of-sample approaches under development.</p>
<h3 id="predictive-validity-based-uncertainty">Predictive Validity-Based Uncertainty</h3>
<p>We have a tool that evaluates predictive validity out of sample for the model
forecasts. It iteratively holds out data points starting with only one
data point used for fitting and adding them back in one by one,
comparing the predictions with the observed data. The standard deviation
observed for these residuals -- along the dimensions of how much data
the model sees and how far out the model needs to predict into the future
-- are then used to simulate draws (random realizations of the mean function)
that can be used to construct uncertainty intervals. This approach is orthogonal
to model-based uncertainty described below.</p>
<h3 id="model-based-uncertainty">Model-Based Uncertainty</h3>
<p>We partition model-based uncertainty into estimates coming  from fixed and random components. Fixed effects capture the variation
of the mean effects, and random effects uncertainty captures the variation across locations.</p>
<ul>
<li>Fixed Effects</li>
</ul>
<p>For any estimator obtained by solving a nonlinear least squares problem, we can use the Fisher information matrix
to get an asymptotic approximation to the uncertainty. Let
<script type="math/tex; mode=display">
\hat{ \theta} = \arg\min_{ \theta} := \frac{1}{2}\theta^T W^{-1} \theta  + \frac{1}{2 \sigma^2} \|\Sigma^{-1/2} (y - f( \theta;  X))\|^2
</script>
where <script type="math/tex">W</script> is any prior variance and <script type="math/tex">\Sigma</script> is the variance of  observations.
Then our approximation for the variance matrix of the estimate is given by
<script type="math/tex; mode=display">
V(\hat \theta) = \mathcal{I}(\theta)^{-1} = \left(J_{\hat \theta}^T \Sigma^{-1} J_{\hat \theta} + W^{-1} \right)^{-1}
</script>
where
<script type="math/tex; mode=display">
J_{\hat{ \theta}} := \nabla_{ \theta} f( \theta;  X)
</script>
is the Jacobian matrix evaluated at <script type="math/tex">\theta = \hat \theta</script>. The Jacobian is also computed using the complex step method.</p>
<ul>
<li>Random effects</li>
</ul>
<p>To obtain the variance of the random effects, we derive an  empirical variance matrix across locations.
Given a set of zero mean random effect estimates <script type="math/tex">\{v_j\}</script>, with each <script type="math/tex">v_j</script> a vector
of <script type="math/tex">k</script> of random effect types, we get an empirical matrix <script type="math/tex">V_0 \in \mathbb{R}^{k\times k}</script> by
<script type="math/tex; mode=display">
V_0 = \frac{1}{n}\sum_{j=1}^N v_j v_j^T
</script>
To obtain posterior uncertainty for each specific location, we use the empirical <script type="math/tex">V_0</script> as a prior,
and any data at the location as the measurement model, and re-fit the  location:
<script type="math/tex; mode=display">
\hat{ \theta}_i = \arg\min_{ \theta} := \frac{1}{2}\theta_i^T V_0^{-1}\theta_i +  \frac{1}{2 \sigma^2} \| \Sigma_i^{-1/2}(y_i - f_i( \theta_i;  X_i))\|^2
</script>
Within each location, this is analogous to the fixed effects analysis. The location-specific uncertainty is then estimated from
the same Fisher information analysis:
<script type="math/tex; mode=display">
V_i({\hat \theta}) =   ( J_i^T  \Sigma_i ^{-1}  J_i + V_0^{-1})^{-1}.
</script>
</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href=".." title="Home" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </div>
            </div>
          </a>
        
        
          <a href="../code/" title="Code" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Code
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>